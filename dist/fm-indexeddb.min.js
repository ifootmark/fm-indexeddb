/**
 * @providesModule fm-indexeddb - IndexedDB
 * @author ifootmark@163.com
 * @version v1.0.0
 * @link https://ifootmark.github.io/fm-indexeddb/
 * @license MIT
 * @time 2016-6-28 15:49:40
 */
"use strict";var localIndexedDB={isSuppoutIndexedDB:function(){return!!window.indexedDB},openDB:function(e,t){var n=e.name||"footmark",o=e.version||1;e.db||(e.db=null);var a=window.indexedDB.open(n,o);a.onerror=function(e){console.log(e.currentTarget.error.message)},a.onsuccess=function(n){var o=n.target.result;o.onversionchange=function(e){o.close(),location.href=location.href},e.db=o,t&&t()},a.onupgradeneeded=function(t){var n=t.target.result;n.onversionchange=function(e){n.close(),location.href=location.href};for(var a=0;a<e.objectStoreList.length;a++){var r=e.objectStoreList[a],c=r.name,d=r.index;if(c&&!n.objectStoreNames.contains(c)){var i=n.createObjectStore(c,{autoIncrement:!0});if(d)for(var u=0;u<d.length;u++){var l=d[u].name,s=d[u].field,f=d[u].unique||!1;l&&s&&i.createIndex(l,s,{unique:f})}}}console.log("IndexedDB version changed to "+o)}},addData:function(e,t,n){var o=e.transaction(t,"readwrite"),a=o.objectStore(t);a.add(n)},getDataByKey:function(e,t,n,o){var a=e.transaction(t,"readwrite"),r=a.objectStore(t),c=r.get(n);c.onsuccess=function(e){var t=e.target.result;o&&o(t)}},getDataByIndex:function(e,t,n,o,a){var r=e.transaction(t),c=r.objectStore(t),d=c.index(n);d.get(o).onsuccess=function(e){var t=e.target.result;a&&a(t)}},updateData:function(e,t,n){var o=e.transaction(t,"readwrite"),a=o.objectStore(t);a.put(n)},deleteDataByKey:function(e,t,n){var o=e.transaction(t,"readwrite"),a=o.objectStore(t);a["delete"](n)},clearObjectStore:function(e,t){var n=e.transaction(t,"readwrite"),o=n.objectStore(t);o.clear()},deleteObjectStore:function(e,t){e.objectStoreNames.contains(t)&&e.deleteObjectStore(t)},deleteDB:function(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=function(e){console.log("Error deleting database.")},t.onsuccess=function(e){console.log("Database deleted successfully")}},getDataByCursor:function(e,t,n){var o=e.transaction(t);o.onerror=function(e){console.log("Error"),preventDefault()},o.oncomplete=function(e){};var a=o.objectStore(t),r=a.openCursor(null,IDBCursor.prev),c={};c.list=[],r.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value;o.id=t.key,c.list.push(o),t["continue"]()}else n&&n(c)}},getDataByIndexAndCursor:function(e,t,n){var o=e.transaction(t),a=o.objectStore(t),r=a.index(n),c=r.openCursor(null,IDBCursor.prev),d=[];c.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;d.push(n),t["continue"]()}else console.log(d)}}},IDB={isSuppoutIndexedDB:localIndexedDB.isSuppoutIndexedDB(),openDB:function(e,t){localIndexedDB.openDB(e,t)},add:function(e,t,n){localIndexedDB.addData(e,t,n)},update:function(e,t,n){localIndexedDB.updateData(e,t,n)},"delete":function(e,t,n){localIndexedDB.deleteDataByKey(e,t,n)},getOneByKey:function(e,t,n,o){localIndexedDB.getDataByKey(e,t,n,o)},getOneByIndex:function(e,t,n,o,a){localIndexedDB.getDataByIndex(e,t,n,o,a)},getAll:function(e,t,n){localIndexedDB.getDataByCursor(e,t,n)},clearDB:function(e,t){localIndexedDB.clearObjectStore(e,t)},deleteDB:function(e){localIndexedDB.deleteDB(e)},closeDB:function(e){e.close()}};!function(e,t){"function"==typeof define&&define.amd?define("IDB",[],t):"object"==typeof module&&module.exports?module.exports=t:e.IDB=t}(this,IDB);