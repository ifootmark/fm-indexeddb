/**
 * @providesModule fm-indexeddb - IndexedDB
 * @author ifootmark@163.com
 * @version v1.0.0
 * @link https://ifootmark.github.io/fm-indexeddb/
 * @license MIT
 * @time 2016-6-29 14:57:35
 */
!function e(n,t,o){function r(i,c){if(!t[i]){if(!n[i]){var d="function"==typeof require&&require;if(!c&&d)return d(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return r(t?t:e)},l,l.exports,e,n,t,o)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,n,t){"use strict";var o={isSuppoutIndexedDB:function(){return!!window.indexedDB},openDB:function(e,n){var t=e.name||"footmark",o=e.version||1;e.db||(e.db=null);var r=window.indexedDB.open(t,o);r.onerror=function(e){console.log(e.currentTarget.error.message)},r.onsuccess=function(t){var o=t.target.result;o.onversionchange=function(e){o.close(),location.href=location.href},e.db=o,n&&n()},r.onupgradeneeded=function(n){var t=n.target.result;t.onversionchange=function(e){t.close(),location.href=location.href};for(var r=0;r<e.objectStoreList.length;r++){var a=e.objectStoreList[r],i=a.name,c=a.index;if(i&&!t.objectStoreNames.contains(i)){var d=t.createObjectStore(i,{keyPath:"id",autoIncrement:!0});if(c)for(var u=0;u<c.length;u++){var l=c[u].name,s=c[u].field,f=c[u].unique||!1;l&&s&&d.createIndex(l,s,{unique:f})}}}console.log("IndexedDB version changed to "+o)}},addData:function(e,n,t){var o=e.transaction(n,"readwrite"),r=o.objectStore(n);r.add(t)},getDataByKey:function(e,n,t,o){var r=e.transaction(n,"readwrite"),a=r.objectStore(n),i=a.get(t);i.onsuccess=function(e){var n=e.target.result;o&&o(n)}},getDataByIndex:function(e,n,t,o,r){var a=e.transaction(n),i=a.objectStore(n),c=i.index(t);c.get(o).onsuccess=function(e){var n=e.target.result;r&&r(n)}},updateData:function(e,n,t){var o=e.transaction(n,"readwrite"),r=o.objectStore(n);r.put(t)},deleteDataByKey:function(e,n,t){var o=e.transaction(n,"readwrite"),r=o.objectStore(n);r["delete"](t)},clearObjectStore:function(e,n){var t=e.transaction(n,"readwrite"),o=t.objectStore(n);o.clear()},deleteObjectStore:function(e,n){e.objectStoreNames.contains(n)&&e.deleteObjectStore(n)},deleteDB:function(e){var n=window.indexedDB.deleteDatabase(e);n.onerror=function(e){console.log("Error deleting database.")},n.onsuccess=function(e){console.log("Database deleted successfully")}},getDataList:function(e,n,t,o,r){var a=e.transaction(n);a.onerror=function(e){console.log("Error"),preventDefault()},a.oncomplete=function(e){};var i=a.objectStore(n),c=null;if(t){var d=i.index(t);c=o?d.openCursor(IDBKeyRange.only(o),IDBCursor.prev):d.openCursor(null,IDBCursor.prev)}else c=i.openCursor(null,IDBCursor.prev);var u={};u.list=[],c.onsuccess=function(e){var n=e.target.result;if(n){var t=n.value;u.list.push(t),n["continue"]()}else r&&r(u)}}},r={isSuppoutIndexedDB:o.isSuppoutIndexedDB(),openDB:function(e,n){o.openDB(e,n)},add:function(e,n,t){o.addData(e,n,t)},update:function(e,n,t){o.updateData(e,n,t)},"delete":function(e,n,t){o.deleteDataByKey(e,n,t)},getOneByKey:function(e,n,t,r){o.getDataByKey(e,n,t,r)},getOneByIndex:function(e,n,t,r,a){o.getDataByIndex(e,n,t,r,a)},getList:function(e,n,t,r,a){o.getDataList(e,n,t,r,a)},clearDB:function(e,n){o.clearObjectStore(e,n)},deleteDB:function(e){o.deleteDB(e)},closeDB:function(e){e.close()}};!function(e,t){"function"==typeof define&&define.amd?define("IDB",[],t):"object"==typeof n&&n.exports?n.exports=t:e.IDB=t}(this,r)},{}],2:[function(e,n,t){"use strict";function o(){var e=$("#brandName"),n=$("#brandCode"),t=$("#remark"),o={};return o.brandName=e.val(),o.brandCode=n.val(),o.remark=t.val(),""==o.brandName?(e.focus(),!1):""==o.brandCode?(n.focus(),!1):void a.getOneByIndex(i.db,c,"nameIndex",o.brandName,function(d){return d?(alert("此品牌名称已存在"),!1):(a.add(i.db,c,o),e.val(""),n.val(""),t.val(""),void r())})}function r(){a.getList(i.db,c,null,null,function(e){if(e.list&&e.list.length>0){$(".v-brand-list").show();var n=template("listtpl",e);$(".v-brand-list table tbody").html(n),$(".v-del").click(function(){if(confirm("确定要删除吗?")){var e=$(this).attr("tag-id");e&&a["delete"](i.db,c,parseInt(e)),r()}})}else $(".v-brand-list table tbody").html(""),$(".v-brand-list").hide()})}var a=e("./fm-indexeddb"),i={name:"footmark",version:1,objectStoreList:[{name:"Brands",index:[{name:"nameIndex",field:"brandName",unique:!1},{name:"codeIndex",field:"brandCode",unique:!1}]}]},c=i.objectStoreList[0].name;$(document).ready(function(){return a.isSuppoutIndexedDB?(a.openDB(i,r),$(".v-add").click(function(){o()}),$(".v-clear").click(function(){confirm("确定要清空数据吗?")&&(a.clearDB(i.db,c),r())}),void $(".v-deldb").click(function(){confirm("确定要删除数据库吗?")&&a.deleteDB(i.name)})):(alert("您的浏览器不支持 IndexedDB"),!1)})},{"./fm-indexeddb":1}]},{},[2]);