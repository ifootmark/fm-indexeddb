/**
 * @providesModule fm-indexeddb - IndexedDB
 * @author ifootmark@163.com
 * @version v1.0.0
 * @link https://ifootmark.github.io/fm-indexeddb/
 * @license MIT
 * @time 2016-6-28 15:49:40
 */
!function e(t,n,o){function r(i,c){if(!n[i]){if(!t[i]){var d="function"==typeof require&&require;if(!c&&d)return d(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var s=n[i]={exports:{}};t[i][0].call(s.exports,function(e){var n=t[i][1][e];return r(n?n:e)},s,s.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){"use strict";var o={isSuppoutIndexedDB:function(){return!!window.indexedDB},openDB:function(e,t){var n=e.name||"footmark",o=e.version||1;e.db||(e.db=null);var r=window.indexedDB.open(n,o);r.onerror=function(e){console.log(e.currentTarget.error.message)},r.onsuccess=function(n){var o=n.target.result;o.onversionchange=function(e){o.close(),location.href=location.href},e.db=o,t&&t()},r.onupgradeneeded=function(t){var n=t.target.result;n.onversionchange=function(e){n.close(),location.href=location.href};for(var r=0;r<e.objectStoreList.length;r++){var a=e.objectStoreList[r],i=a.name,c=a.index;if(i&&!n.objectStoreNames.contains(i)){var d=n.createObjectStore(i,{autoIncrement:!0});if(c)for(var u=0;u<c.length;u++){var s=c[u].name,l=c[u].field,f=c[u].unique||!1;s&&l&&d.createIndex(s,l,{unique:f})}}}console.log("IndexedDB version changed to "+o)}},addData:function(e,t,n){var o=e.transaction(t,"readwrite"),r=o.objectStore(t);r.add(n)},getDataByKey:function(e,t,n,o){var r=e.transaction(t,"readwrite"),a=r.objectStore(t),i=a.get(n);i.onsuccess=function(e){var t=e.target.result;o&&o(t)}},getDataByIndex:function(e,t,n,o,r){var a=e.transaction(t),i=a.objectStore(t),c=i.index(n);c.get(o).onsuccess=function(e){var t=e.target.result;r&&r(t)}},updateData:function(e,t,n){var o=e.transaction(t,"readwrite"),r=o.objectStore(t);r.put(n)},deleteDataByKey:function(e,t,n){var o=e.transaction(t,"readwrite"),r=o.objectStore(t);r["delete"](n)},clearObjectStore:function(e,t){var n=e.transaction(t,"readwrite"),o=n.objectStore(t);o.clear()},deleteObjectStore:function(e,t){e.objectStoreNames.contains(t)&&e.deleteObjectStore(t)},deleteDB:function(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=function(e){console.log("Error deleting database.")},t.onsuccess=function(e){console.log("Database deleted successfully")}},getDataByCursor:function(e,t,n){var o=e.transaction(t);o.onerror=function(e){console.log("Error"),preventDefault()},o.oncomplete=function(e){};var r=o.objectStore(t),a=r.openCursor(null,IDBCursor.prev),i={};i.list=[],a.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value;o.id=t.key,i.list.push(o),t["continue"]()}else n&&n(i)}},getDataByIndexAndCursor:function(e,t,n){var o=e.transaction(t),r=o.objectStore(t),a=r.index(n),i=a.openCursor(null,IDBCursor.prev),c=[];i.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;c.push(n),t["continue"]()}else console.log(c)}}},r={isSuppoutIndexedDB:o.isSuppoutIndexedDB(),openDB:function(e,t){o.openDB(e,t)},add:function(e,t,n){o.addData(e,t,n)},update:function(e,t,n){o.updateData(e,t,n)},"delete":function(e,t,n){o.deleteDataByKey(e,t,n)},getOneByKey:function(e,t,n,r){o.getDataByKey(e,t,n,r)},getOneByIndex:function(e,t,n,r,a){o.getDataByIndex(e,t,n,r,a)},getAll:function(e,t,n){o.getDataByCursor(e,t,n)},clearDB:function(e,t){o.clearObjectStore(e,t)},deleteDB:function(e){o.deleteDB(e)},closeDB:function(e){e.close()}};!function(e,n){"function"==typeof define&&define.amd?define("IDB",[],n):"object"==typeof t&&t.exports?t.exports=n:e.IDB=n}(this,r)},{}],2:[function(e,t,n){"use strict";function o(){var e=$("#brandName"),t=$("#brandCode"),n=$("#remark"),o={};return o.brandName=e.val(),o.brandCode=t.val(),o.remark=n.val(),""==o.brandName?(e.focus(),!1):""==o.brandCode?(t.focus(),!1):void a.getOneByIndex(i.db,c,"nameIndex",o.brandName,function(d){return d?(alert("此品牌名称已存在"),!1):(a.add(i.db,c,o),e.val(""),t.val(""),n.val(""),void r())})}function r(){a.getAll(i.db,c,function(e){if(e.list&&e.list.length>0){$(".v-brand-list").show();var t=template("listtpl",e);$(".v-brand-list table tbody").html(t),$(".v-del").click(function(){if(confirm("确定要删除吗?")){var e=$(this).attr("tag-id");e&&a["delete"](i.db,c,parseInt(e)),r()}})}else $(".v-brand-list table tbody").html(""),$(".v-brand-list").hide()})}var a=e("./fm-indexeddb"),i={name:"footmark",version:1,objectStoreList:[{name:"Brands",index:[{name:"nameIndex",field:"brandName",unique:!1},{name:"codeIndex",field:"brandCode",unique:!1}]}]},c=i.objectStoreList[0].name;$(document).ready(function(){return a.isSuppoutIndexedDB?(a.openDB(i,r),$(".v-add").click(function(){o()}),$(".v-clear").click(function(){confirm("确定要清空数据吗?")&&(a.clearDB(i.db,c),r())}),void $(".v-deldb").click(function(){confirm("确定要删除数据库吗?")&&a.deleteDB(i.name)})):(alert("您的浏览器不支持 IndexedDB"),!1)})},{"./fm-indexeddb":1}]},{},[2]);